# М7 платформа — маркетплейс внутри Telegram Mini App

## Слоган
М7 платформа — пространство для знакомств, товаров и услуг, жилья и работы в одном Mini App: «для всех и каждого».

## Концепция и миссия
- **Единый Mini App в Telegram**, где пользователь может:
  - найти людей для общения, отношений, дружбы или сотрудничества;
  - найти или предложить товары и услуги;
  - найти или сдать жильё;
  - найти работу или разместить вакансию / резюме.
- Минимум переключений между сервисами: все ключевые жизненные сценарии внутри одного опыта в Telegram.

## География и язык
- **Старт**: Санкт-Петербург.
- **Масштабирование**: сначала вся РФ, далее — глобальный рынок.
- **Язык интерфейса**: русский на старте; мультиязычность заложена как следующий этап.

## Целевая аудитория и возрастные ограничения
- **ЦА**: любые пользователи Telegram, которым нужны знакомства, товары/услуги, жильё или работа.
- **Возрастные правила**:
  - Если возраст **не подтверждён**: доступны знакомства (без 18+), товары/услуги; недоступны разделы «Жильё» и «Работа», 18+ контент заблокирован.
  - При **подтверждённом возрасте**: открываются разделы жилья и работы; может быть разблокирован 18+ контент в рамках правил и законодательства.

## Авторизация и роль Telegram-бота
### Ключевые принципы
- Авторизация не опирается на стандартный `initData` Telegram WebApp.
- Используется **username + одноразовый код**, доставленный через бота.

### Поток авторизации
1. Пользователь открывает Mini App.
2. Вводит свой Telegram **@username**.
3. Backend инициирует отправку кода через бота.
4. Бот присылает одноразовый код в личные сообщения.
5. Пользователь вводит код в Mini App.
6. Backend проверяет код и создаёт новый аккаунт или открывает существующий, после чего возвращает Mini App сессию/токен (детали будут конкретизированы позже).
- **@username обязателен** и является значимой частью профиля на платформе.

### Роль бота
- **Авторизация**: отправка кодов и подтверждение username.
- **Уведомления**:
  - новые матчи в знакомствах;
  - отклики на вакансии/резюме;
  - отклики на объявления (товары, услуги, жильё);
  - события модерации (одобрено/отклонено, жалобы, блокировки);
  - платежи и подписка (успешный платёж, окончание, напоминания).
- **Быстрые действия**:
  - кнопка «открыть Mini App»;
  - переход в чат с пользователем по матчу/объявлению.

## Режимы использования и монетизация
### Бесплатный режим
- Доступен всем авторизованным пользователям.
- Фокус — **знакомства**: анкета, поиск людей, свайпы как в Tinder, матчи.
- Ограничения: лимиты по анкетам/свайпам/просмотрам (точные параметры уточняются).
- Полный доступ к размещению в маркете/жилье/работе ограничен (просмотр обсуждается, размещение — по подписке).

### Режим по подписке
- Открывает размещение и активный поиск в разделах **товары/услуги, жильё, работа**.
- Расширенные функции: больше фильтров, повышенные лимиты, продвижение (поднятие, выделение), усиленные возможности в знакомствах (больше свайпов, расширенные фильтры).

### Разовые платные услуги
- Поднятие объявления.
- Закрепление в списке.
- Выделение цветом/рамкой.
- «Суперлайки» и аналогичные бусты в знакомствах.

## Основные разделы платформы
### Знакомства
- **Назначение**: быстрый поиск людей для отношений, дружбы, делового общения.
- **Сущности**: профиль/анкета (имя/ник, возраст, город, цели, интересы, фото и др.), матч (двусторонний интерес).
- **Интерфейс**: свайпы влево/вправо как в Tinder; фильтры по городу, возрасту, полу, целям, интересам и т.д.
- **Доступ**: открыт в бесплатном режиме; ограничения/лимиты могут сниматься подпиской.

### Маркет (товары и услуги)
- **Назначение**: размещение и поиск товаров и услуг (аналог маркетплейса / Авито).
- **Сущности**: объявление (категория, название, цена, описание, фото, локация и пр.).
- **Фильтры**: категории, цена, местоположение, состояние и т.д.
- **Доступ**: полноценное размещение — по подписке; просмотр может быть доступен всем (требует уточнения).

### Жильё
- **Назначение**: аренда жилья (позже возможно расширение на продажу).
- **Сущности**: объект жилья (тип, район/город, цена, фото, условия аренды и т.д.).
- **Фильтры**: тип, район/город, цена, длительность аренды, наличие мебели и т.д.
- **Доступ**: только после подтверждения возраста; размещение и расширенные фильтры — по подписке.

### Работа
- **Назначение**: поиск работы и специалистов (аналог hh / Профи / Авито Работа).
- **Сущности**: вакансия; резюме/профиль исполнителя.
- **Фильтры**: город, формат (офис/удалёнка), график, уровень дохода, опыт и т.д.
- **Доступ**: только после подтверждения возраста; публикация вакансий/резюме — по подписке.

## Модерация и роль ИИ
- **Гибридная модерация**: человек задаёт правила и принимает финальные решения; ИИ помогает автоматизировать первичный отбор.
- **ИИ-помощь**: фильтрация текстов (стоп-слова, запрещённый контент), анализ изображений (обнажёнка, насилие, запрещённые темы), антиспам, первичная проверка подозрительных анкет/объявлений.
- Пользователи могут отправлять жалобы; после жалобы возможна ручная проверка и блокировка/скрытие.

## Рекомендации и ранжирование
- Персонализация и сортировка планируются по:
  - геолокации (город, район);
  - возрасту, полу, целям, интересам — в знакомствах;
  - категориям и параметрам объявлений — в маркете;
  - типу и параметрам жилья (цена, локация) — в разделе жилья;
  - сфере работы, навыкам, опыту, зарплатным ожиданиям — в разделе работы.
- Активность пользователя (частота визитов) может учитываться как вторичный фактор в будущих версиях.

## Технологический стек (черновой план)
- **Mini App (frontend)**: Next.js (App Router, 14.x), TypeScript, работа внутри Telegram WebApp.
- **Backend (первый этап)**: API-роуты в Next.js (Node.js + TypeScript); при росте нагрузки возможно вынесение в отдельный сервис.
- **База данных**: Postgres через Supabase; ORM — Prisma.
- **Авторизация и коммуникации**: Telegram Bot API (бот живёт в `apps/bot`).
- **Деплой**: фронт и API — Vercel (MVP); бот — serverless на Vercel или выделенный хостинг (обсуждается).

## Переменные окружения (черновой список)
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_BOT_USERNAME`
- `TELEGRAM_WEBHOOK_SECRET` (при использовании вебхуков)
- `NEXT_PUBLIC_APP_ENV`
- `NEXT_PUBLIC_API_BASE_URL`
- `DATABASE_URL` (Postgres / Supabase)
- `NEXT_PUBLIC_TELEGRAM_BOT_NAME` (при необходимости на фронте)
- Опционально для прямой работы фронта с Supabase: `SUPABASE_URL`, `SUPABASE_ANON_KEY`.

## Архитектурный поток (концептуально)
1. Пользователь в Telegram открывает Mini App.
2. Вводит свой **@username**.
3. Mini App обращается к backend’у → backend инициирует отправку кода через бота.
4. Бот отправляет код в личные сообщения пользователю.
5. Пользователь вводит код в Mini App.
6. Backend проверяет код, создаёт/читает пользователя в Postgres и отдаёт Mini App сессию/токен.
7. Далее пользователь:
   - создаёт анкету знакомств;
   - при подписке размещает объявления (товары, услуги, жильё, работа);
   - ищет по фильтрам;
   - получает уведомления от бота (матчи, отклики, модерация, платежи).

## Роли компонентов
- **Mini App**: UI/UX внутри Telegram WebApp; сбор данных пользователя, показ лент и карточек, вызовы backend API.
- **Бот**: отправка кодов авторизации, уведомления, быстрые действия для возврата в Mini App или связи с пользователем.
- **Backend**: проверка кодов, управление подписками, модерация, обработка объявлений, API для Mini App и бота.
- **База данных (Postgres/Supabase)**: хранение пользователей, анкет, объявлений, подписок, логов модерации.

## Структура репозитория
- `apps/miniapp/` — будущий Telegram Mini App (Next.js + TypeScript) с разделами: знакомства, маркет, жильё, работа.
- `apps/bot/` — будущий Telegram-бот для авторизации, уведомлений и быстрых действий.
- `packages/shared/` — будущие общие типы, модели домена, константы и утилиты.
- `docs/` — архитектурные и продуктовые документы (черновики, брифы, схемы).

## Правила для задач и документации
- Любая выполненная задача (любой исполнителем) **обязана**:
  - обновлять корневой `README.md` и/или соответствующий документ в `docs/`, чтобы архитектура и логика оставались актуальными;
  - добавлять подпункт в раздел `## История изменений / Tasks log` со структурой: краткое имя задачи, дата, список затронутых файлов/папок, краткое описание изменённой архитектуры/логики (поток данных: пользователь → интерфейс → backend → база → обратно).
- Цель: чтобы по одному `README.md` и документам в `docs/` любой новый разработчик или ИИ-архитектор быстро понимал, что делает М7 платформа и где искать код конкретных частей.

## История изменений / Tasks log

### Инициализация репозитория и базовой структуры (дата: 2025-12-05)
- Затронутые файлы и папки:
  - `README.md`
  - `apps/miniapp/README.md`
  - `apps/bot/README.md`
  - `packages/shared/README.md`
  - `docs/README.md`
  - создана базовая структура директорий `apps/`, `packages/`, `docs/`.
- Краткое описание:
  - Создан монорепозиторий `m7-platform` под проект «М7 платформа» — маркетплейс внутри Telegram Mini App.
  - Описана общая концепция продукта (знакомства, товары/услуги, жильё, работа), география, ЦА и возрастные ограничения.
  - Зафиксирована схема авторизации через Telegram-бота (username + код) и роль бота (авторизация, уведомления, быстрые действия).
  - Обозначен черновой технологический стек (Next.js, Node.js, Postgres/Supabase, Prisma, Telegram Bot API) и список переменных окружения.
  - Описан архитектурный поток: от открытия Mini App и ввода username → отправки кода ботом → проверки кода backend’ом → работы с разделами и уведомлениями.

